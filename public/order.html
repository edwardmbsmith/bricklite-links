<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light" />
  <title>Order a Still Tag</title>
  <style>
    :root {
      color-scheme: light;
      --page-padding: clamp(16px, 2vw + 12px, 28px);
    }
    * {
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, system-ui, sans-serif;
      margin: 0;
      padding: var(--page-padding);
      background: #f5f7fb;
      color: #0f172a;
      line-height: 1.6;
    }
    .page {
      max-width: 960px;
      margin: 0 auto;
      background: #fff;
      padding: clamp(20px, 3vw + 12px, 36px);
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(15, 23, 42, 0.12);
    }
    h1 {
      margin-top: 0;
      font-size: clamp(26px, 2vw + 18px, 32px);
      letter-spacing: -0.02em;
    }
    p {
      color: #334155;
    }
    .card {
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 20px;
      margin: 18px 0 26px;
      background: #f8fafc;
    }
    .card h2 {
      margin-top: 0;
      font-size: clamp(20px, 2vw + 12px, 24px);
      color: #0f172a;
    }
    ul {
      color: #334155;
      line-height: 1.5;
    }
    .field {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin: 18px 0 10px;
    }
    .field label {
      font-weight: 600;
      color: #0f172a;
    }
    .field input {
      padding: 12px 14px;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      font-size: 16px;
      font-family: inherit;
    }
    .field input:focus {
      outline: 2px solid #0f172a;
      outline-offset: 1px;
    }
    .cta {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 14px 20px;
      background: #0f172a;
      color: #fff;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 150ms ease, box-shadow 150ms ease;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.18);
      width: min(360px, 100%);
    }
    .cta:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 32px rgba(15, 23, 42, 0.2);
    }
    .cta:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .notice {
      padding: 14px 16px;
      border-radius: 10px;
      background: #fff7ed;
      border: 1px solid #fdba74;
      color: #9a3412;
      margin-top: 14px;
    }
    .footer {
      margin-top: 24px;
      color: #64748b;
      font-size: 14px;
    }
    a {
      color: #0f172a;
      font-weight: 600;
    }
    @media (max-width: 640px) {
      body { padding: 14px; }
      .page { padding: 20px; border-radius: 12px; }
      .cta { width: 100%; }
      .card { padding: 16px; }
    }
    @media (prefers-reduced-motion: reduce) {
      * { scroll-behavior: auto !important; }
      .cta { transition: none; }
    }
  </style>
</head>
<body>
  <main class="page">
    <h1>Order a Still tag</h1>
    <p>Each tag costs £5 total with free Royal Mail Second Class postage so you can quickly resume your calm experience in Still. Checkout is handled securely by Stripe.</p>

    <div class="card">
      <h2>How it works</h2>
      <ul>
        <li>Tap the button below to open a secure Stripe Checkout page.</li>
        <li>The £5 total includes your Still tag and free Royal Mail Second Class delivery.</li>
        <li>After payment you'll get a receipt email with your order details.</li>
      </ul>
    </div>

    <div class="field">
      <label for="receipt-email">Email for your receipt</label>
      <input id="receipt-email" name="receipt-email" type="email" autocomplete="email" required placeholder="you@example.com" />
    </div>

    <button id="checkout-button" class="cta" type="button">
      <span>Pay £5 with free delivery</span>
    </button>
    <div id="setup-warning" class="notice" role="alert" aria-live="polite" style="display:none;"></div>

    <div class="footer">
      <p>If you have trouble checking out, reply to your receipt email and we'll help right away.</p>
      <p style="margin-top:16px; font-weight:600;">Still is currently available in the UK only.</p>
      <p><a href="/index.html">Back to Still links</a></p>
    </div>
  </main>

  <script>
    (() => {
      const button = document.getElementById('checkout-button');
      const warning = document.getElementById('setup-warning');
      const emailInput = document.getElementById('receipt-email');

      const setLoading = (isLoading) => {
        button.disabled = isLoading;
        button.setAttribute('aria-busy', isLoading ? 'true' : 'false');
        button.textContent = isLoading ? 'Redirecting to Stripe…' : 'Pay £5 with free delivery';
      };

      const showError = (message) => {
        warning.textContent = message;
        warning.style.display = 'block';
      };

      button.addEventListener('click', async () => {
        if (!window.fetch) {
          showError('Your browser is too old to start checkout. Please update and try again.');
          return;
        }

        setLoading(true);
        warning.style.display = 'none';

        const email = emailInput.value.trim();
        if (!email) {
          showError('Please enter the email address for your receipt.');
          setLoading(false);
          return;
        }

        try {
          const response = await fetch('/create-checkout-session', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
          });

          const data = await response.json();
          if (!response.ok || !data?.url) {
            throw new Error(data?.error || 'Unable to start Stripe Checkout.');
          }

          window.location.href = data.url;
        } catch (error) {
          showError(error.message || 'Unexpected error starting checkout.');
          setLoading(false);
        }
      });
    })();
  </script>
</body>
</html>
